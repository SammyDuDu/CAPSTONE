{% extends 'base.html' %}
{% block content %}
    <div class="desc-box">
        <div class="desc-title"><span id="soundSymbol">{{ sound }}</span></div>
        <div class="desc-text" id="descText">
            {{ description if description is defined else 'Write the pronunciation tips for this sound here.' }}
        </div>
    </div>

    <button class="record-btn" id="recordBtn" aria-pressed="false" title="Record 2 seconds">Record</button>

    <div class="analysis-status" id="analysisStatus"></div>
    <div class="analysis-feedback" id="analysisFeedback"></div>

    <div class="cards">
        <div class="card" data-feature="tongue-height">
            <div class="img-ph"></div>
            <div class="card-title">Tongue Height</div>
            <div class="card-body">--</div>
        </div>
        <div class="card" data-feature="tongue-backness">
            <div class="img-ph"></div>
            <div class="card-title">Tongue Backness</div>
            <div class="card-body">--</div>
        </div>
        <div class="card" data-feature="lips-roundness">
            <div class="img-ph"></div>
            <div class="card-title">Lips Roundness</div>
            <div class="card-body">--</div>
        </div>
        <div class="card" data-feature="breathiness">
            <div class="img-ph"></div>
            <div class="card-title">Breathiness</div>
            <div class="card-body">--</div>
        </div>
        <div class="card" data-feature="tension">
            <div class="img-ph"></div>
            <div class="card-title">Tension</div>
            <div class="card-body">--</div>
        </div>
        <div class="card total" data-feature="total">
            <div class="card-title">Total</div>
            <div class="percent"></div>
            <div class="card-body">--</div>
            <div class="score-progress-bar">
                <div class="score-progress-fill" id="scoreProgressFill" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <div class="analysis-plot" id="analysisPlot" hidden>
        <div class="plot-controls">
            <button class="plot-toggle-btn" id="plotModeToggle" title="Switch plot display mode">
                <span id="plotModeLabel">Formant Chart</span>
                <span class="toggle-arrow">â‡„</span>
            </button>
        </div>
        <div style="position: relative; display: inline-block;">
            <img id="analysisPlotImage" alt="Vowel placement chart">
            <canvas id="plotCanvas" style="position: absolute; top: 0; left: 0; pointer-events: none;"></canvas>
        </div>
        <div class="analysis-plot-caption" id="analysisPlotCaption"></div>
    </div>

    <script src="{{ url_for('static', path='scripts/plot-animation.js') }}"></script>
    <script src="{{ url_for('static', path='scripts/sound.js') }}"></script>
    <script>
        (function () {
            // Read sound from query string and store it
            const params = new URLSearchParams(window.location.search);
            const s = params.get('s');
            if (s) {
                localStorage.setItem('selectedSound', s);
                const el = document.getElementById('soundSymbol');
                if (el) el.textContent = s;
            }
        })();
    </script>
{% endblock %}
